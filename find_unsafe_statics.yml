language: Rust
id: find-unsafe-statics
rule:
  any:
    - kind: static_item
    - kind: macro_invocation
      any:
        - has:
            kind: identifier
            pattern: thread_local
        - has:
            kind: scoped_identifier
            regex: "std::thread_local"
  not:
    inside:
      kind: mod_item
      has:
        kind: identifier
        any:
          - pattern: tests
          - pattern: test
          - pattern: test_util
      stopBy: end
